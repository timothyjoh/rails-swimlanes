# Project Status

> Auto-generated by cc-pipeline. Last updated after Phase 5.

## Overview
Swimlanes is a Trello-like board management app built with Rails 8, Hotwire (Turbo + Stimulus), Tailwind CSS, and SQLite. Users will be able to create boards with swimlane columns and draggable cards, with card details, board sharing, real-time updates, and customizable backgrounds.

**Current state:** Users can sign up, log in, create boards, and manage a full board canvas. Each board has swimlane columns that can be added, renamed, and deleted. Cards can be created in any lane, renamed, deleted, and dragged to reorder within a lane or moved to a different lane — with order persisting after reload. Clicking a card opens a detail modal where users can add a description, set a due date, and attach color-coded labels (red, yellow, green, blue, purple). Board owners can share boards with other registered users by email — collaborators see the board on their index, and can create, edit, and delete swimlanes and cards. Owner-only controls (rename/delete board, manage members) are hidden from collaborators. Non-members get a 404 on any board URL. **All changes to cards and swimlanes are broadcast live to every board member via ActionCable** — no page reload required to see another user's updates.

---

## Phase 1: Project Setup, Authentication, and Board CRUD

### What We Built
- Rails 8 app scaffolded with SQLite, Tailwind CSS, Hotwire (Turbo + Stimulus), and Importmap
- Sign up (`/registration/new`), log in (`/session/new`), and log out flows
- Built-in Rails 8 authentication (no Devise) — `rails generate authentication` + manual `RegistrationsController`
- Board CRUD: create, list, edit, delete; boards index is the authenticated root (`/`)
- Boards are user-scoped — only the owner can view, edit, or delete their boards
- Board name presence validation (model + controller)
- Flash messages for create/update/delete actions
- `AGENTS.md`, `README.md` created; `CLAUDE.md` updated with AGENTS.md instruction block

### How to Run It
```bash
export PATH="/usr/local/lib/ruby/gems/3.4.0/bin:/usr/local/opt/ruby/bin:$PATH"
bin/setup --skip-server   # install gems, prepare DB, npm install
bin/rails server          # start at http://localhost:3000
```
Visit `http://localhost:3000`, sign up with an email and password, and start creating boards. You'll see a card grid of your boards with Edit and Delete links on each card.

### Review Findings
- **MUST-FIX resolved — SimpleCov parallelization**: `parallelize(workers: :number_of_processors)` caused SimpleCov to under-report coverage. Fixed by switching to `parallelize(workers: 1)`. Coverage now correctly reports 82.31%.
- **MUST-FIX resolved — DB null constraint**: `boards.name` was nullable at the DB level despite model validation. Added migration `add_not_null_to_boards` to enforce `null: false` at the database layer.
- **Fixed — `User.take` non-determinism**: `sessions_controller_test.rb` changed from `User.take` to `users(:one)` for stable fixture selection.
- **Fixed — missing negative sign-up assertion**: Added `assert_not User.exists?` to the mismatched-password test.
- **Fixed — boards index missing negative scope assertion**: Added second-user board to fixture and `assert_no_match` to verify scoping.
- **Fixed — E2E login URL assertion**: Added `toHaveURL('/boards')` to the login success test.
- **Deferred — `before_action :require_authentication` implicit**: `ApplicationController` relies on implicit behavior from the `Authentication` concern rather than declaring it explicitly. Functionally correct but noted for Phase 2.
- **Deferred — `show` action out of scope**: A `GET /boards/:id` route and view were added outside Phase 1 scope with no authorization test. Phase 2 will promote this to the full board canvas for swimlanes.
- **Deferred — whitespace board names pass validation**: `presence: true` allows `"   "`. Noted for future attention.

### What's Next
- **Phase 2**: Swimlane (column) model + Card model, board show page as the main canvas, Swimlane CRUD, Card CRUD, drag-and-drop reordering with SortableJS
- Promote the `show` action into a real board detail page where swimlanes will live
- Add explicit `before_action :require_authentication` to `ApplicationController`
- Add authorization test for the `show` action
- Commit per task (not per phase) going forward

### Test Coverage
- **Command**: `bin/rails test`
- **Result**: 30 runs, 71 assertions, **0 failures, 0 errors, 0 skips**
- **Coverage**: **82.31%** line coverage (107/130 lines) — above the 80% minimum threshold
- **Tests added this phase**:
  - `test/models/user_test.rb` — email presence, uniqueness
  - `test/models/board_test.rb` — name presence, user association required
  - `test/controllers/sessions_controller_test.rb` — login success/failure
  - `test/integration/authentication_flow_test.rb` — sign up, sign in, invalid credentials, unauthenticated redirect, log out
  - `test/integration/boards_flow_test.rb` — create, blank name error, edit, delete, cross-user access denial, index scoping
  - `e2e/auth.spec.js` — sign up → boards, log out → login, unauthenticated redirect
  - `e2e/boards.spec.js` — create board, edit board name, delete board
- **Not yet covered**: `show` action authorization, sign-up with duplicate email (HTTP flow), whitespace-only board names

---

## Phase 2: Swimlanes and Cards with Drag-and-Drop

### What We Built
- `Swimlane` model (`name`, `position`, `board_id`) with DB-enforced not-null constraints and whitespace-stripping validation
- `Card` model (`name`, `position`, `swimlane_id`) with the same validation pattern
- Full board canvas at `GET /boards/:id` — displays board name, all swimlane columns in order, and all cards in each lane in order
- Swimlane CRUD (create, rename, delete) via Turbo Streams — no full-page reload; new lane appears immediately; delete cascades to all its cards
- Card CRUD (create, rename, delete) via Turbo Streams — inline interaction within each lane
- Drag-and-drop card reordering with SortableJS: drag within a lane to reorder, drag to another lane to move; positions persisted via `PATCH /boards/:board_id/swimlanes/:swimlane_id/cards/reorder`
- All swimlane and card routes nested under `/boards/:board_id`; authorization chain scopes through `Current.user.boards` — wrong-owner requests return 404
- Explicit `before_action :require_authentication` added to `ApplicationController` (Phase 1 tech debt)
- Board name whitespace-stripping validation added (Phase 1 tech debt)
- SortableJS pinned via importmap CDN; Stimulus `sortable_controller.js` handles `onEnd` event and sends PATCH
- Shared Playwright auth helpers extracted to `e2e/helpers/auth.js` — used across all E2E specs

### How to Run It
```bash
export PATH="/usr/local/lib/ruby/gems/3.4.0/bin:/usr/local/opt/ruby/bin:$PATH"
bin/setup --skip-server   # install gems, prepare DB, npm install
bin/rails server          # start at http://localhost:3000
```
Sign up, create a board, navigate to the board. You'll see a horizontal lane layout — click "Add Lane" to create columns, then "Add Card" within any lane to add cards. Click a card or lane name to rename inline. Drag cards between lanes or within a lane to reorder.

### Review Findings
- **Fixed — boards#show auth test missing**: Integration test added in `b3f839a` covering authenticated access and 404 for cross-user boards.
- **Open — Ruby-level sort bypasses DB ordering**: `swimlane.cards.sort_by(&:position)` in the swimlane partial sorts an already-loaded relation in Ruby instead of using SQL ordering. Functionally correct but inconsistent with the established `.order(:position)` pattern. Fix deferred to Phase 3.
- **Open — reorder action missing bounds guard**: `Array#insert` at position > array length pads with `nil`, causing `NoMethodError` on a raw PATCH with a large `position` value. A `position.clamp(0, cards.length - 1)` guard is needed. Deferred to Phase 3.
- **Open — swimlane partial uses `<div>` not `turbo_frame_tag`**: The PLAN specified wrapping swimlane headers in `turbo_frame_tag dom_id(swimlane)`, but the implementation uses a plain `<div>`. The Cancel link on the rename form consequently loads the full board page into the frame rather than restoring the header. Deferred to Phase 3.
- **Open — new swimlane appends after "Add Lane" button**: `turbo_stream.append "swimlanes"` places new lanes after the form column because the button is the last child of `#swimlanes`. New lanes appear to the right of the input. Deferred to Phase 3.
- **Open — E2E drag tests use `fetch` not DOM drag**: Playwright drag tests call the PATCH endpoint directly rather than simulating a real SortableJS drag. Tests the server but not the Stimulus controller, SortableJS initialization, or CSRF token handling. Deferred to Phase 3.

### What's Next
- **Phase 3 carry-over fixes first**: (1) `turbo_frame_tag` wrapper + cancel link, (2) reorder bounds guard, (3) new-swimlane append order, (4) SQL ordering on card association
- **Phase 3 feature**: Card details — clicking a card opens an expanded view with description, due date, and color-coded labels
- Establish DOM-level Playwright drag test using `page.dragAndDrop()` or the `mouse` API
- Add E2E coverage for swimlane and card rename flows

### Test Coverage
- **Command**: `bin/rails test`
- **Result**: 73 runs, 171 assertions, **0 failures, 0 errors, 0 skips**
- **Coverage**: **86.19%** line coverage (206/239 lines) — above the 80% minimum threshold
- **Tests added this phase**:
  - `test/models/swimlane_test.rb` — name validation, position scoping, cascade destroy
  - `test/models/card_test.rb` — name validation, position scoping, association
  - `test/integration/swimlanes_flow_test.rb` — CRUD (HTML + Turbo Stream), cross-user 404, whitespace name rejection
  - `test/integration/cards_flow_test.rb` — CRUD via Turbo Streams, cross-user 404
  - `test/integration/cards_reorder_test.rb` — reorder within lane, cross-lane move, cross-user 404, unauthenticated redirect
  - `test/integration/boards_flow_test.rb` — extended with `boards#show` auth test
  - `e2e/board_canvas.spec.js` — create/delete swimlane, create/delete card, drag card (via PATCH stub)
- **Known gaps**:
  - Reorder with out-of-bounds `position` (no guard, no test)
  - Cascade destroy test uses only 1 card — a 2-card assertion would be unambiguous
  - E2E: rename swimlane and card inline edit flows not covered
  - E2E: actual DOM drag interaction not tested (only server-side PATCH stub)

---

## Phase 3: Card Details — Descriptions, Due Dates, and Labels

### What We Built
- **Card detail modal**: clicking a card title opens a `<dialog>` detail view via Turbo Frame (`card_N_detail`) — no full-page reload
- **Card description**: free-text textarea on the detail view; saves via Turbo Stream; card face shows a description indicator (`≡`) when one is present
- **Due dates**: date input on the detail view; card face shows a formatted date badge (e.g., "Feb 18"); overdue cards (past due date) show a red badge
- **Color-coded labels**: 5 predefined labels (red, yellow, green, blue, purple) toggled via checkboxes; selected labels appear as color chips on the card face; labels stored in a `labels` table with a `card_labels` join table
- **`Card` model** updated: added `description` (text, nullable), `due_date` (date, nullable), `overdue?` method, `overdue` and `upcoming` scopes, `has_many :labels through: :card_labels`
- **`Label` model** (new): `color` string with inclusion validation; COLORS constant; unique index on color; seeded via `bin/rails db:seed`
- **`CardLabel` join model** (new): `card_id` and `label_id` FK references with unique composite index
- **DB-level card ordering**: `has_many :cards, -> { order(:position) }` scope on `Swimlane` — Ruby-side `sort_by` anti-pattern eliminated
- **N+1 fix**: `BoardsController#show` now uses `includes(cards: :labels)` to batch-load labels
- **E2E drag test replaced**: `board_canvas.spec.js` drag test now uses Playwright `dragAndDrop()` on real DOM elements and asserts card order changed (no more `fetch` stub)
- **Cards reorder clamp guard** confirmed in place: `position.clamp(0, ...)` prevents `NoMethodError` on out-of-range values
- Close button on card detail navigates Turbo Frame back to the empty board state
- AGENTS.md and README.md updated to document Label, CardLabel, card detail route, and Phase 3 features

### How to Run It
```bash
export PATH="/usr/local/lib/ruby/gems/3.4.0/bin:/usr/local/opt/ruby/bin:$PATH"
bin/setup --skip-server   # install gems, prepare DB, npm install
bin/rails db:seed         # creates 5 predefined labels (run once)
bin/rails server          # start at http://localhost:3000
```
Sign up, create a board, add a swimlane and a card. Click the card title — a modal opens where you can add a description, pick a due date, and toggle color labels. Close the modal and the card face shows description indicator, date badge, and label chips.

### Review Findings
- **MUST-FIX resolved — Description/due-date forms used `_top` navigation**: Both forms had `data: { turbo_frame: "_top" }`, causing full-page reloads instead of Turbo Stream updates (spec violation). Fixed by removing that attribute — forms now stay in frame context and route through `format.turbo_stream`.
- **MUST-FIX resolved — E2E drag assertion was vacuous**: `toHaveCount(2)` confirmed cards still existed but did not verify order changed. Fixed by asserting `secondIdx < firstIdx` using `allTextContents()` — confirms the card actually moved.
- **MUST-FIX resolved — Overdue badge integration test was too shallow**: Test only asserted model state (`card.reload.overdue?`). Fixed by adding `assert_match "overdue", response.body` to verify the rendered Turbo Stream HTML includes the overdue CSS class.
- **Open — Close button uses inline JS**: The close button in `show.html.erb` uses a raw `onclick` with `removeChild` DOM manipulation. Works but fragile if Turbo Frame structure changes. A small Stimulus action would be more maintainable. Deferred to Phase 4.
- **Open — README Phase 3 entry missing `✓` checkmark**: Minor cosmetic inconsistency with Phase 1 and 2 entries. Deferred.
- **Open — Upcoming scope today boundary not tested**: `upcoming` scope uses `due_date >= Date.current` but there is no test asserting a card due today appears in `upcoming`. Deferred.
- **Open — No `assert_queries` guard for N+1 regression**: The label N+1 fix was applied but there's no test that would catch a regression. Deferred.

### What's Next
- **Phase 4**: Board sharing between users — allow owners to invite collaborators; shared boards visible in invitee's boards index
- Deferred from Phase 3: Stimulus dialog close action, README checkmark cleanup, upcoming-scope boundary test, N+1 regression guard
- Checklists / checklist items (originally deferred from Phase 3 scope)
- Label chip on card face close button inline JS refactor

### Test Coverage
- **Command**: `bin/rails test`
- **Result**: 89 runs, 212 assertions, **0 failures, 0 errors, 0 skips**
- **Coverage**: **87.06%** line coverage (222/255 lines) — above the 80% minimum threshold
- **Tests added this phase**:
  - `test/models/card_test.rb` — `overdue?` method (past/today/future/nil), `overdue` scope, `upcoming` scope
  - `test/models/label_test.rb` (new) — valid/invalid colors, uniqueness constraint, COLORS constant
  - `test/integration/cards_flow_test.rb` — card show (auth + cross-user 404), description update (Turbo Stream), due date update (overdue CSS in response body), label add/remove
  - `e2e/board_canvas.spec.js` — drag reorder replaced with real `dragAndDrop()` + DOM order assertion
  - `e2e/card_detail.spec.js` (new) — open detail modal, add description (card face indicator), set future due date (badge), set past due date (overdue red badge), toggle label on/off (chip appears/disappears)
- **Known gaps**:
  - `upcoming` scope: no boundary test for cards due today
  - No `assert_queries` or Bullet guard to catch N+1 regression on label loading
  - Invalid label ID parameter handling (Rails silently ignores — not tested)
  - No integration test asserting Turbo Stream response body includes label chip HTML on label save

---

## Phase 4: Board Sharing

### What We Built
- **`BoardMembership` model** — join table connecting boards to users with a `role` enum (`owner` / `member`); unique index on `[board_id, user_id]` prevents duplicate memberships
- **`Board.accessible_by(user)` scope** — returns boards where user has any membership; replaces the old `Current.user.boards` owner-scoped query across all controllers
- **Authorization sweep** — all 5 auth check sites updated: `BoardsController#index`, `BoardsController#set_board`, `SwimlanesController#set_board`, `CardsController#set_board`, `CardsController#reorder`; `require_owner!` guard added before edit/update/destroy on boards
- **Board creation** seeds an owner `BoardMembership` row inside a transaction — no orphan boards if the second insert fails
- **`MembershipsController`** — `POST /boards/:board_id/memberships` (add member by email, owner-only), `DELETE /boards/:board_id/memberships/:id` (remove member, owner-only); both respond with Turbo Streams, no page reloads
- **Members panel** on the board show page (owner-only) — lists current members ordered by role then created_at, with a Remove button on non-owner rows; includes an add-by-email form
- **View gates** — Edit/Delete board controls on index and show pages wrapped in owner-only conditionals; `@owned_board_ids` set precomputed in controller to avoid N+1 per board card
- **Collaborator access** — member-role users see shared boards on their index, can read the board, and create/edit/delete swimlanes and cards; cannot delete or rename the board
- **Non-member 404** — any board URL (board, swimlane, card) accessed by a non-member returns 404, not 403 (no board-existence leakage)
- `MembershipsController` and `BoardMembership` added to AGENTS.md project structure and data model sections; README Phase 4 entry marked complete

### How to Run It
```bash
export PATH="/usr/local/lib/ruby/gems/3.4.0/bin:/usr/local/opt/ruby/bin:$PATH"
bin/setup --skip-server   # install gems, prepare DB, npm install
bin/rails db:seed         # creates 5 predefined labels (run once)
bin/rails server          # start at http://localhost:3000
```
Sign up as User A, create a board, open it — you'll see a Members panel at the bottom listing yourself as owner. Type another registered user's email and click Add — they appear in the list immediately (Turbo Stream). Sign in as that user and their boards index now shows the shared board. They can create cards but won't see Edit Board or Delete controls.

### Review Findings
- **MUST-FIX resolved — No transaction in `BoardsController#create`**: Board save and owner membership creation weren't atomic. Fixed by wrapping both in `ActiveRecord::Base.transaction`.
- **MUST-FIX resolved — `@board.members.include?(user)` loaded full association**: The duplicate-check in `MembershipsController#create` loaded all members into memory. Fixed by replacing with `BoardMembership.exists?(board: @board, user: user)`.
- **MUST-FIX resolved — Missing collaborator PATCH/DELETE test coverage**: SPEC required tests for collaborator updating/deleting cards and swimlane CRUD. Added 4 integration tests (collab can update card, delete card, create swimlane, delete swimlane).
- **MUST-FIX resolved — Membership list non-deterministic ordering**: `.order(:role, :created_at)` was in the plan but omitted from the view. Fixed so the owner row always appears first.
- **Fixed — AGENTS.md project structure stale**: `MembershipsController` and `BoardMembership` added to the top-level structure section.
- **Open — `require_owner!` fires two queries per owner-only action**: `set_board` loads board via membership join, then `require_owner!` runs a separate EXISTS check. Acceptable now; could cache `@current_membership` if needed.
- **Open — `BoardMembership.exists?` in views**: Owner check in `show.html.erb` is a raw DB call per render. `@owned_board_ids` approach used on index but not show. Low impact for a single-board view.
- **Open — Unused `signIn` import in E2E spec**: Imported but never called since separate browser contexts are used instead. Minor lint issue.

### What's Next
- **Phase 5**: Real-time updates via ActionCable — broadcast card and swimlane events to all board members; channel authentication scoped to `Board.accessible_by`
- Research ActionCable session auth with Rails 8's cookie-based `Current.user` pattern before building any UI
- Start narrow: one event type (card created) end-to-end before expanding to swimlanes and membership events
- Technical debt: cache `@current_membership` to eliminate the double-query on owner-only actions; add a `BoardMembership.ordered` named scope; upcoming-scope boundary test from Phase 3

### Test Coverage
- **Command**: `bin/rails test`
- **Result**: 118 runs, 275 assertions, **0 failures, 0 errors, 0 skips**
- **Coverage**: **89.18%** line coverage (272/305 lines) — above the 80% minimum threshold
- **Tests added this phase**:
  - `test/models/board_membership_test.rb` (new) — valid membership, requires board/user/role, duplicate prevention, `owner?`/`member?` enum predicates
  - `test/models/board_test.rb` — `accessible_by` scope includes member boards, excludes non-member boards
  - `test/integration/memberships_flow_test.rb` (new) — add member (valid email → Turbo Stream; unknown email → error; already-member → error), remove member (success; owner-protected redirect), collaborator can view board / create card / update card / delete card / create swimlane / delete swimlane, collaborator cannot delete or rename board, non-member gets 404 on board and nested resources, shared board appears on collaborator's index, non-owner cannot call membership endpoints
  - `test/integration/boards_flow_test.rb` / `swimlanes_flow_test.rb` / `cards_flow_test.rb` — updated to create owner memberships alongside boards so existing tests continue to pass
  - `e2e/board_sharing.spec.js` (new) — owner adds collaborator → collaborator sees board and creates card, owner removes collaborator → board disappears from collaborator index, non-member navigates to board URL → board content not shown
- **Known gaps**:
  - No integration test for `GET edit_board_path` by a collaborator (code path is covered by `require_owner!` but untested)
  - `assert_match dom_id(membership)` in remove-member test doesn't verify the turbo-stream action is `remove` specifically
  - Upcoming-scope boundary test (cards due today) still deferred from Phase 3
  - No N+1 regression guard on label loading

---

## Phase 5: Real-Time Collaboration via ActionCable

### What We Built
- **`BoardChannel`** — new channel inheriting from `Turbo::StreamsChannel`; overrides `subscribed` to verify the HMAC-signed stream name, locate the Board from its GlobalID, and check `BoardMembership.exists?` — non-members and unauthenticated connections are rejected
- **Two-layer WebSocket auth**: connection-level (`ApplicationCable::Connection` reads the session cookie and sets `current_user`; rejects unauthenticated) + channel-level (`BoardChannel` verifies board membership before streaming)
- **`turbo_stream_from @board, channel: BoardChannel`** added to `boards/show.html.erb` — browsers automatically subscribe to the board's ActionCable stream when the page loads
- **Card broadcasts** in `CardsController`: `broadcast_append_to` after create, `broadcast_replace_to` after update, `broadcast_remove_to` after destroy, remove + append pair after reorder (cross-lane move)
- **Swimlane broadcasts** in `SwimlanesController`: `broadcast_append_to` after create, `broadcast_replace_to` (header partial) after update, `broadcast_remove_to` after destroy
- **Destroy guard**: both `CardsController#destroy` and `SwimlanesController#destroy` wrap the broadcast inside `if @record.destroy` — prevents false-removal broadcasts if a destroy callback halts the chain
- **`signInAs` alias** added to `e2e/helpers/auth.js` — non-breaking export alias of `signIn` for Phase 5 E2E specs
- **`e2e/realtime.spec.js`** — 5 multi-context Playwright tests: card created by owner appears for collaborator, card deleted by owner disappears for collaborator, card moved between lanes (API-direct PATCH), swimlane created by owner appears, swimlane deleted by owner disappears
- **AGENTS.md** updated with `app/channels/board_channel.rb` structure entry and ActionCable Authentication section documenting both auth layers and the controller-level broadcast approach
- **README.md** Phase 5 marked complete

### How to Run It
```bash
export PATH="/usr/local/lib/ruby/gems/3.4.0/bin:/usr/local/opt/ruby/bin:$PATH"
bin/setup --skip-server   # install gems, prepare DB, npm install
bin/rails db:seed         # creates 5 predefined labels (run once)
bin/rails server          # start at http://localhost:3000
```
Open the same board in two browser windows (or two users in separate incognito windows). Create, rename, move, or delete a card in one window — it appears/updates/disappears in the other instantly, with no page reload. Same for swimlane create and delete.

### Review Findings
- **MUST-FIX resolved — Missing E2E card move test**: SPEC and PLAN both required an E2E test for "owner moves card between swimlanes; collaborator sees move without reload." Not implemented in the initial build. Fixed in MUST-FIX by adding the fifth scenario to `e2e/realtime.spec.js` using an API-direct `page.request.patch` call (CSRF disabled in test env).
- **MUST-FIX resolved — Unguarded destroy broadcasts**: `CardsController#destroy` and `SwimlanesController#destroy` were broadcasting removal unconditionally, even if `destroy` returned `false`. Fixed by guarding broadcasts behind a truthy `destroy` result.
- **Open — `verify_stream_name` API deviation**: PLAN specified the inherited `verify_stream_name(...)` method from `Turbo::StreamsChannel`. This method does not exist in turbo-rails 2.0.23. Implementation uses `Turbo.signed_stream_verifier.verified(...)` directly — functionally equivalent but touches a private/undocumented API. Cannot fix without a gem upgrade; documented as technical debt.
- **Open — Non-semantic channel test assertions**: `assert subscription.rejected?` used instead of the idiomatic `assert_reject_subscription`. Passes but produces a less helpful failure message. Low priority.
- **Open — No negative broadcast test**: No test asserts that a *failed* save (blank name) does NOT enqueue a broadcast. Low risk since validation prevents the broadcast path; deferred.
- **Open — E2E card delete selector fragility**: Delete button located with `card.locator('button').click()` — will click the wrong button if a card gains multiple buttons in a later phase.

### What's Next
- **Phase 6 (final)**: Board background customization — add a `background` column to `boards`, a picker UI with preset colors and gradients, and apply the value as inline CSS on the board container. No ActionCable surface; should be straightforward.
- **Technical debt**: `Turbo.signed_stream_verifier.verified(...)` is a private API — revisit when turbo-rails is upgraded; E2E card move test uses API-direct PATCH instead of real drag-and-drop simulation
- **Carry-over gaps**: `upcoming` scope boundary test (cards due today), N+1 regression guard for label loading, `GET edit_board_path` collaborator denial test

### Test Coverage
- **Command**: `bin/rails test`
- **Result**: 129 runs, 300 assertions, **0 failures, 0 errors, 0 skips**
- **Coverage**: **86.23%** line coverage (288/334 lines) — above the 80% minimum threshold
- **Tests added this phase**:
  - `test/channels/board_channel_test.rb` (new) — member subscription accepted, non-member rejected, nil user rejected, invalid stream name rejected
  - `test/integration/cards_flow_test.rb` — 4 broadcast tests: card create/update/destroy/reorder each assert `assert_broadcasts @board.to_gid_param, N` plus HTTP response
  - `test/integration/swimlanes_flow_test.rb` — 3 broadcast tests: swimlane create/update/destroy each assert `assert_broadcasts @board.to_gid_param, 1`
  - `e2e/realtime.spec.js` (new) — 5 multi-context real-time scenarios (card create, delete, move; swimlane create, delete)
- **Known gaps**:
  - E2E card move test uses API-direct PATCH, not a real drag-and-drop UI interaction
  - No negative broadcast test (failed save should not broadcast)
  - No E2E network-level verification that a non-member WebSocket subscription is rejected
  - `upcoming` scope today boundary test still deferred from Phase 3

---
